extends Node3D

@export var enemy_scene : PackedScene
@export var spawn_radius : float = 20.0 
@export var spawn_rate : float = 2.0 

var timer = 0.0

func _process(delta):
	timer += delta
	if timer >= spawn_rate:
		spawn_enemy()
		timer = 0.0

func spawn_enemy():
	var enemy = enemy_scene.instantiate()
	
	var spawn_radius = 50.0 
	var angle = randf() * PI * 2
	
	var pos = Vector3(cos(angle) * spawn_radius, 0, sin(angle) * spawn_radius)
	var cercas = get_tree().get_nodes_in_group("cercas") 
	var cerca_proxima: Node3D = null
	var menor_distancia = INF
	for cerca in cercas:
		if not cerca is Node3D:
			continue
			
		var distancia = spawn_enemy().distance_to(cerca.global_transform.origin)
		if distancia < menor_distancia:
			menor_distancia = distancia
			cerca_proxima = cerca
	get_tree().root.add_child(enemy)
	enemy.posicao_cerca = cerca_proxima.global_position
	enemy.global_position =spaw_
